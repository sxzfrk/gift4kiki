<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Level 2 - Pirate's Hook</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-color: #d0f0ff;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #87ceeb;
      border-bottom: 6px solid #006994;
    }
    #game-ui {
      margin-top: 10px;
    }
    #win-screen {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff5f8;
      border: 4px solid #ff69b4;
      border-radius: 15px;
      padding: 30px;
      display: none;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    #win-screen h2 {
      color: #ff1493;
      margin-bottom: 10px;
    }
    #next-level-btn {
      padding: 10px 20px;
      font-size: 1rem;
      background: #ff69b4;
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    #loading {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-top: 20px;
    }
  </style>
</head>
<body class="level2">
  <canvas id="gameCanvas" width="800" height="500"></canvas>
  <div id="game-ui">
    <p>üéØ Hold <strong>Spacebar</strong> to drop the hook and catch 3 treasure chests!</p>
    <p>Chests Collected: <span id="score">0</span>/3</p>
    <div id="loading">Loading game assets...</div>
  </div>

  <div id="win-screen">
    <h2>üè¥‚Äç‚ò†Ô∏è Captain! You found all the treasure!</h2>
    <p>cheesecake says: RAWR CAPTAIN üßÄü¶ñ</p>
    <button id="next-level-btn" onclick="goToLevel3()">Go to Level 3</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const loadingText = document.getElementById("loading");

    let hookX = 400;
    let hookY = 60;
    let direction = 1;
    let dropping = false;
    let reeling = false;
    let treasuresCaught = 0;
    let gameOver = false;

    const treasures = [
      { x: 130, y: 410 },
      { x: 350, y: 420 },
      { x: 580, y: 410 },
    ];
    const fish = [
      { x: 150, y: 300, speed: 2 },
      { x: 500, y: 330, speed: -1.5 },
      { x: 200, y: 350, speed: 1.8 },
      { x: 600, y: 370, speed: -2 },
      { x: 400, y: 310, speed: 1.2 },
    ];

    const images = {};
    const imageSources = {
      treasure: 'images/treasure.png',
      fish: 'images/fish.png'
    };

    function preloadImages(sources, callback) {
      let loadedCount = 0;
      const total = Object.keys(sources).length;
      for (let key in sources) {
        images[key] = new Image();
        images[key].src = sources[key];
        images[key].onload = () => {
          loadedCount++;
          if (loadedCount === total) {
            callback();
          }
        };
      }
    }

    function drawBoatAndHook() {
      ctx.fillStyle = "#8b4513";
      ctx.fillRect(hookX - 40, 20, 80, 30);
      ctx.strokeStyle = "#000";
      ctx.beginPath();
      ctx.moveTo(hookX, 50);
      ctx.lineTo(hookX, hookY);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(hookX, hookY, 10, 0, Math.PI * 2);
      ctx.fillStyle = "#333";
      ctx.fill();
    }

    function drawTreasures() {
      treasures.forEach(t => {
        if (!t.caught) {
          ctx.drawImage(images.treasure, t.x, t.y, 40, 40);
        }
      });
    }

    function drawFish() {
      fish.forEach(f => {
        ctx.drawImage(images.fish, f.x, f.y, 50, 30);
        f.x += f.speed;
        if (f.x > canvas.width || f.x < -50) f.speed *= -1;
      });
    }

    function checkCatch() {
      treasures.forEach((t) => {
        if (!t.caught) {
          const hookHitbox = { x: hookX - 15, y: hookY - 15, width: 30, height: 30 };
          const treasureHitbox = { x: t.x, y: t.y, width: 40, height: 40 };
          const isColliding = (
            hookHitbox.x < treasureHitbox.x + treasureHitbox.width &&
            hookHitbox.x + hookHitbox.width > treasureHitbox.x &&
            hookHitbox.y < treasureHitbox.y + treasureHitbox.height &&
            hookHitbox.y + hookHitbox.height > treasureHitbox.y
          );
          if (isColliding) {
            t.caught = true;
            treasuresCaught++;
            document.getElementById("score").innerText = treasuresCaught;
            if (treasuresCaught >= 3) {
              document.getElementById("win-screen").style.display = 'block';
              gameOver = true;
            }
          }
        }
      });
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!gameOver) {
        if (!dropping && !reeling) {
          hookX += direction * 2;
          if (hookX > 750 || hookX < 50) direction *= -1;
        }
        if (dropping) {
          hookY += 4;
          if (hookY > 460) {
            dropping = false;
            reeling = true;
            checkCatch();
          }
        } else if (reeling) {
          hookY -= 4;
          if (hookY <= 60) {
            reeling = false;
          }
        }
      }

      drawBoatAndHook();
      drawFish();
      drawTreasures();

      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === 'Space' && !dropping && !reeling && !gameOver) {
        dropping = true;
      }
    });

    function goToLevel3() {
      window.location.href = "level3.html";
    }

    preloadImages(imageSources, () => {
      loadingText.style.display = "none";
      gameLoop();
    });
  </script>
</body>
</html>
